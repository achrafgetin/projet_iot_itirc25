{% extends 'base.html' %}
{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Graphique de Température</h1>
</div>

<div class="btn-toolbar mb-2 mb-md-0">
    <div class="btn-group mr-2">
        <button id="aujourdhui-link" class="btn btn-sm btn-outline-secondary">Aujourd'hui</button>
        <button id="semaine-link" class="btn btn-sm btn-outline-secondary">Cette Semaine</button>
        <button id="mois-link" class="btn btn-sm btn-outline-secondary">Ce Mois</button>
    </div>
</div>

<canvas class="my-4 w-100" id="graphique-temp" height="380"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@1.3.0/dist/chartjs-plugin-zoom.min.js"></script>
<script>
    const createChart = (url, borderWidth) => {
        fetch(url)
            .then(response => response.json())
            .then(data => {
                const labels = data.temps;
                const dataValues = data.temperature;
                const ctx = document.getElementById('graphique-temp').getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Température (°C)',
                            data: dataValues,
                            backgroundColor: 'rgba(0, 123, 255, 0.2)',
                            borderColor: 'rgba(0, 123, 255, 1)',
                            borderWidth: borderWidth,
                            pointRadius: 3,
                            pointBackgroundColor: 'rgba(0, 123, 255, 1)'
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Température (°C)'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Temps'
                                }
                            }
                        },
                        plugins: {
                            zoom: {
                                zoom: {
                                    wheel: {
                                        enabled: true,
                                    },
                                    pinch: {
                                        enabled: true
                                    },
                                    mode: 'xy',
                                },
                                pan: {
                                    enabled: true,
                                    mode: 'xy',
                                }
                            }
                        }
                    }
                });
            });
    };

    document.getElementById('aujourdhui-link').addEventListener('click', () => createChart('/chart-data-jour/', 2));
    document.getElementById('semaine-link').addEventListener('click', () => createChart('/chart-data-semaine/', 2));
    document.getElementById('mois-link').addEventListener('click', () => createChart('/chart-data-mois/', 2));

    // Charge initiale du graphique
    createChart('/chart-data/', 2);
</script>
{% endblock %}